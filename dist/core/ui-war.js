"use strict";!function(){angular.module("ui.war",[])}(),function(){function warGrid($http){return{restrict:"AE",replace:!0,scope:{gridConfig:"=",clickcell:"&",onloadsuccess:"&",ondelete:"&",clearSelect:"="},templateUrl:"app/tableGrid/war.tableGrid.html",link:function(scope,element,attrs){function pitchOn(e){angular.forEach(scope.selects,function(e,t){scope.selects[t]=!1}),scope.selects[e]=!0}function changetab(e){angular.forEach(scope.tabs,function(e,t){scope.tabs[t]=!1}),scope.tabs[e]=!0,scope.currentPage=e}function getConfig(){var e={};return e=angular.extend(e,scope.gridConfig),JSON.stringify(e)}function filterColumns(){}function iWatch(){var config={method:scope.gridConfig.method,url:scope.gridConfig.url};if("POST"===scope.gridConfig.method?(config.data=angular.extend({},scope.gridConfig.data),(void 0==config.data.page||""==config.data.page)&&(config.data.page=1,changetab(1)),config.data.pageSize=scope.gridConfig.pageSize):"GET"===scope.gridConfig.method&&(config.params=scope.gridConfig.data),""!=scope.gridConfig.url&&void 0!=scope.gridConfig.url)$http(config).success(function(data){scope.onloadsuccess({data:data});var myData=data.data;if("yes"==data.flag&&(myData=eval("("+data.data+")"),data.totalCount=myData.length),scope.data=myData,scope.totalCountArr=[],scope.total=Math.ceil(data.totalCount/scope.gridConfig.pageSize),scope.totalIsNaN=isNaN(scope.total),scope.total>6){var startPage=scope.currentPage-2,endPage=scope.currentPage+2;0>=startPage&&(endPage-=startPage-1,startPage-=startPage-1),endPage>=scope.total&&(startPage=scope.total-5,endPage=scope.total)}else var startPage=1,endPage=scope.total;for(var i=startPage;endPage>=i;i++)scope.totalCountArr.push(i)}).error(function(e){throw"数据加载错误，请联系管理员!"});else{var data={statusCode:"200",data:[],totalCount:0};if(scope.onloadsuccess({data:data}),scope.data=data.data,scope.totalCountArr=[],scope.total=Math.ceil(data.totalCount/scope.gridConfig.pageSize),scope.totalIsNaN=isNaN(scope.total),scope.total>6){var startPage=scope.currentPage-2,endPage=scope.currentPage+2;0>=startPage&&(endPage-=startPage-1,startPage-=startPage-1),endPage>=scope.total&&(startPage=scope.total-5,endPage=scope.total)}else var startPage=1,endPage=scope.total;for(var i=startPage;endPage>=i;i++)scope.totalCountArr.push(i)}}scope.currentPage=0,scope.GridFilterArr=[],scope.ReplaceFilter=[],scope.totalCountArr=[],scope.tabs=[!0],scope.selects=[],scope.width=0,angular.isDefined(scope.gridConfig.radio)||(scope.gridConfig.radio=!0),angular.forEach(scope.gridConfig.columns,function(data){angular.isDefined(data.type)||(data.type="text"),scope.GridFilterArr.push(data.field);var fn=eval(data.filter);data.filter&&scope.ReplaceFilter.push({field:data.field,replaceArr:fn()}),scope.width+=data.width});var cellClick=scope.gridConfig.onCellClick;scope.onCellClick=function(e,t,a,i){var c={id:e.id,field:t,value:a};if(!cellClick)throw i.stopPropagation(),"xGrid 配置没有 onCellClick 函数,请添加!";cellClick(c),i.stopPropagation()},scope["delete"]=function(e){scope.ondelete(e),angular.forEach(scope.data,function(t,a){t==e.data&&scope.data.splice(a,1)})},scope.onclickcell=function(e,t){if("undefined"!=typeof scope.clearSelect&&(scope.clearSelect=!1),1==scope.gridConfig.radio)if(1==scope.selects[t]){scope.selects[t]=!1;for(var a in e)e[a]="";scope.clickcell(e)}else scope.clickcell(e),pitchOn(t)},scope.tab=function(e){changetab(e),scope.gridConfig.data=angular.extend({},scope.gridConfig.data),scope.gridConfig.data.page=scope.currentPage},scope.next=function(){scope.currentPage<scope.total&&scope.tab(++scope.currentPage)},scope.prev=function(){scope.currentPage>0&&scope.tab(--scope.currentPage)},scope.first=function(){scope.tab(1)},scope.last=function(){scope.tab(scope.total)},scope.$watch("clearSelect",function(){1==scope.clearSelect&&(scope.selects=[])}),scope.$watch(getConfig,function(e,t){iWatch(),pitchOn(-1)})}}}angular.module("ui.war").directive("warGrid",warGrid).filter("GridFilter",function(){return function(e,t){for(var a=[],i=0;i<t.length;i++)a.push(e[t[i]]);return a}}).filter("replaceFilter",function(){return function(e,t){for(var a=0;a<t.length;a++)for(var i=0;i<t[a].replaceArr.length;i++)e[t[a].field]==t[a].replaceArr[i].tags&&(e[t[a].field]=t[a].replaceArr[i].name);return e}})}(),function(){function e(){return{restrict:"EA",replace:!0,scope:{},templateUrl:"",link:function(e,t,a){}}}angular.module("ui.war").directive("warTree",e)}(),angular.module("ui.war").run(["$templateCache",function(e){e.put("app/tableGrid/war.tableGrid.html",'<div class="table-responsive"><table class="table b-t b-light" ng-style="{\'width\':width}" ng-class="{\'table-hover\':gridConfig.radio||gridConfig.checkbox}"><thead><tr><th ng-repeat="item in gridConfig.columns" ng-bind="item.title" ng-style="{\'width\':item.width}"></th><th ng-if="gridConfig.button.delete"></th></tr></thead><tbody><tr ng-repeat="item in data" ng-click="onclickcell({data:item},$index)" ng-class=\'{"striped":$index%2==0,"active":selects[$index]}\'><td ng-repeat="items in item | replaceFilter:ReplaceFilter |GridFilter:GridFilterArr track by $index" ng-switch="gridConfig.columns[$index].type"><a ng-switch-when="text" ng-bind="items"></a> <input ng-switch-when="input" ng-model="items"> <a ng-switch-when="link" ng-bind="items" class="" ng-click="onCellClick(item,gridConfig.columns[$index].field,items,$event)"></a></td><td ng-if="gridConfig.button.delete"><i class="fa fa-close text-danger" ng-click="delete({data:item})"></i></td></tr></tbody></table><div class="b-t text-center padder-h-xs" ng-class="{\'hide\':total<=1 || total == undefined || totalIsNaN}"><ul class="pagination pagination-sm m-t-none m-b-none"><li ng-click="prev()"><a href=""><i class="fa fa-chevron-left"></i></a></li><li ng-if="currentPage > 3 && total>6" ng-click="first()"><a href="">1</a></li><li ng-if="currentPage > 3 && total>6"><a href=""><i class="fa fa-ellipsis-h"></i></a></li><li ng-click="tab(item)" ng-repeat="item in totalCountArr" ng-class="{\'active\':tabs[item]}"><a href="" ng-bind="item">1</a></li><li ng-if="currentPage < total-3 && total>6"><a href=""><i class="fa fa-ellipsis-h"></i></a></li><li ng-if="currentPage < total-3 && total>6" ng-click="last()"><a href="" ng-bind="total"></a></li><li ng-click="next()"><a href=""><i class="fa fa-chevron-right"></i></a></li></ul></div></div>'),e.put("app/tree/war.tree.html","<div>tree</div>")}]);